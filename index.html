<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hinäzuma Läitu</title>
  <!-- 引入Kiineza Laaitu字体 -->
  <style>
    @font-face {
      font-family: 'KiinezaLaaitu';
      src: url('fonts/Kiineza_Laaitu.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }
    :root {
        --primary: #318cd3;
        --secondary: #ebc185;
        --background: #07080b;
        --warning: #fc2537;
    }

    body {
      margin: 0;
      background: #111;
      color: #fff;
      font-family: 'KiinezaLaaitu', sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    .screen {
      flex: 1;
      display: grid;
      grid-template-rows: auto 1fr auto;
      gap: 10px;
      padding: 20px;
      box-sizing: border-box;
    }
    /* 顶部角色图像区域*/
    #image-area {
      position: relative;
      height: 300px;
      overflow: hidden;
    }
    #image-area img {
      max-height: 100%;
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      user-select: none;
      pointer-events: none;
    }
    /* 中间打字内容区 */
    #typing-area {
      padding: 5px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #current-word {
      font-size: 5.5rem;
    }

    #current-word.countdown {
      font-size: 6rem;
    }


    #current-word span.correct {
      color: var(--primary);
    }
    #translation {
      font-size: 2rem;
      color: #666;
      margin-top: 10px;
    }
    /* 小字倒计时 */
    #timer-small {
      color: var(--secondary);
      margin-top: 5px;
      display: flex;
      align-items: center;
    }
    #timer-small .timer-icon { font-size: 1.4rem; margin-right: 0.5rem; }
    #timer-small .timer-num  { font-size: 2.2rem; }
    

    /* 底部键盘反馈区 */
    .keyboard-feedback {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 2px;
      padding: 1rem;
    }
    .key {
      background: #222;
      padding: 1.2rem 0.5rem;
      text-align: center;
      border-radius: 4px;
      position: relative;
      cursor: default;
    }
    .key::after {
      content: attr(data-kaasa);
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      top: 0.8rem;
      font-size: 2.5em;
      color: var(--secondary);
      opacity: 0.8;
    }
    .key.active { 
      background: var(--primary);
    }
    .key.active::after {
      color: var(--background);
    }
    .key.wrong  { 
      background: var(--warning);
    }
    .key.wrong::after {
      color: var(--background);
    }
    .key.disabled, .key[data-kaasa=""] {
      background: #151515;
    }

    /* 选键位屏幕 */
    #select-layout {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 10;
    }
    #select-layout h2    { 
      font-weight: normal;
      color: #fff; 
      font-size: 2.5rem;
    }
    .layout-option {
      margin: 15px;
      cursor: pointer;
      border: 2px solid var(--primary);
      border-radius: 8px;
      overflow: hidden;
      transition: border-color 0.2s;
    }
    .layout-option:hover { border: 2px solid var(--secondary); }

    /* 结果屏幕 */
    #result-screen {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.95);
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 2rem 5rem;
      padding: 0.5rem;
      z-index: 20;
    }

    #result-character {
      width: auto;                /* 根据需要调整尺寸 */
      height:  300px;
      flex-shrink: 0;
    }



    #result-text {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #result-screen h1    { 
      font-weight: normal;
      color: #fff; 
      font-size: 2.8rem;
    }
    
    #result-screen .stats {
      font-size: 1.6rem;
      line-height: 1;
    }

    /* 数字部分更大 */
    #result-screen .stats .value {
      font-size: 2.4rem;
    }
    

    #result-screen button {
      margin-top: 30px;
      padding: 6px 16px;
      font-size: 1.6rem;
      cursor: pointer;
      background: #aaa;
      color: var(--background);
      border: none;
      border-radius: 6px;
      font-family: 'KiinezaLaaitu';
    }
    #result-screen button ::after {
      bottom:1rem;
    }
    #result-screen button:hover { background: var(--primary); }
  </style>
</head>
<body>
  <div id="select-layout">
    <h2>helAb</h2>
    <div class="layout-option" data-layout="alternate">
      <img src="layouts/alternate.png" alt="Ez" width="300">
    </div>
    <div class="layout-option" data-layout="double">
      <img src="layouts/double.png" alt="El" width="300">
    </div>
  </div>

  <div class="screen" id="game-screen" style="visibility: hidden;">
    <div id="image-area">
      <img id="character" src="images/character_idle.png" alt="Kävilak">
    </div>
    <div id="typing-area">
      <div id="current-word">sozanAm</div>
      <div id="translation">trGnslKSyn</div>
      <div id="timer-small">50</div>
    </div>
    <div class="keyboard-feedback" id="keyboard"></div>
  </div>



  <div id="result-screen" style="display: none;">
    <img id="result-character" alt="Siköm" src="" />
    <div id="result-text">
      <h1 id="rank">sikOm</h1>
      <div id="wpm" class="stats">kUxik/a sUz' 0</div>
      <div id="accuracy" class="stats">bEsut/a sUz' 0</div>
      <div id="final-score" class="stats">tenIl/a sUz' 0</div>
      <button id="restart">zed/e sikAs</button>
  </div>

  <!-- 背景音乐，loop 循环播放 -->
  <audio id="bg-music" src="audio/bg-music.ogg" loop preload="auto"></audio>

  <!-- 音效：正确、错误、单词完成 -->
  <audio id="sfx-correct" src="audio/correct.ogg" preload="auto"></audio>
  <audio id="sfx-wrong"   src="audio/wrong.ogg"   preload="auto"></audio>
  <audio id="sfx-done"    src="audio/done.ogg"    preload="auto"></audio>

  <!-- 倒计时音效，长度3秒 -->
  <audio id="countdown-sound" src="audio/countdown.mp3" preload="auto"></audio>

  <!-- 积分为正时的结束音乐 -->
  <audio id="end-positive-sound" src="audio/end-positive.mp3" preload="auto"></audio>


  <script>
    
    // --------- 配置区 ---------
    const ROUND_TIME     = 72;   // 游戏时长（秒）
    const BONUS_SCORE     = 1728;
    const PUNISH_SCORE     = 1296;
    const COUNTDOWN_TIME = 3;    // 倒计时长度（秒）
    const encodedData = "W3sidGV4dCI6InpJeGV2aWsiLCJ0cmFuc2xhdGlvbiI6IkZpbiJ9LHsidGV4dCI6InpJeGV0T2siLCJ0cmFuc2xhdGlvbiI6IkZpayJ9LHsidGV4dCI6Inppc0l4YWsiLCJ0cmFuc2xhdGlvbiI6Im1HZ25pdCwgbUdnbmV0aWsifSx7InRleHQiOiJ6ZXRhdk96IiwidHJhbnNsYXRpb24iOiJ0VSBzaXQifSx7InRleHQiOiJ6ZWQiLCJ0cmFuc2xhdGlvbiI6InNpbWlseSwgbEprd0p6LCByaXBldGl0aXYsIHh5Z2VuLCB4b2xzWCwgdFUifSx7InRleHQiOiJ6YW5hdGV0IiwidHJhbnNsYXRpb24iOiJ0VSBwdVMifSx7InRleHQiOiJ6YW5BbSIsInRyYW5zbGF0aW9uIjoibEdOZ3dpcSJ9LHsidGV4dCI6InphbiIsInRyYW5zbGF0aW9uIjoibEt0eSwgZmpVY3ksIHh5aGVkLCBmckhudCJ9LHsidGV4dCI6InphbWF0ZXQiLCJ0cmFuc2xhdGlvbiI6InRVIHB1bCJ9LHsidGV4dCI6InpBbWFtIiwidHJhbnNsYXRpb24iOiJ0Sm0ifSx7InRleHQiOiJ6YW0iLCJ0cmFuc2xhdGlvbiI6InhZbGkveSwgcEFzdCwgYmloSm5kLCByUSwgYkdrIn0seyJ0ZXh0IjoiekFrQXMiLCJ0cmFuc2xhdGlvbiI6ImpVbml2WXMifSx7InRleHQiOiJ6YWhpa0FsaWwiLCJ0cmFuc2xhdGlvbiI6IndKdCJ9LHsidGV4dCI6Inh1IiwidHJhbnNsYXRpb24iOiJzWCJ9LHsidGV4dCI6InhveiIsInRyYW5zbGF0aW9uIjoic2V2eW4ifSx7InRleHQiOiJ4b21PeiIsInRyYW5zbGF0aW9uIjoic0huIn0seyJ0ZXh0IjoieG9tQW0iLCJ0cmFuc2xhdGlvbiI6InN0QSwgeHlzdHJ5bm9taWt5bCB4SGJxZWt0In0seyJ0ZXh0IjoieG9sIiwidHJhbnNsYXRpb24iOiJ4S3QifSx7InRleHQiOiJ4b2tBcyIsInRyYW5zbGF0aW9uIjoiVnkgbUhWWSBwbEduaXQifSx7InRleHQiOiJ4b2hVbCIsInRyYW5zbGF0aW9uIjoibVVuIn0seyJ0ZXh0IjoieG9iQWIiLCJ0cmFuc2xhdGlvbiI6ImtvbWl0LCBtSXRpL3kifSx7InRleHQiOiJ4byIsInRyYW5zbGF0aW9uIjoieEduZCJ9LHsidGV4dCI6InhJbiIsInRyYW5zbGF0aW9uIjoidFUgaEd2LCB0VSBreW50S24ifSx7InRleHQiOiJ4aWtPbCIsInRyYW5zbGF0aW9uIjoiYkksIGJJIHhJa3d5bCB0VSJ9LHsidGV4dCI6InhpIiwidHJhbnNsYXRpb24iOiJ4TywgeEpWeSJ9LHsidGV4dCI6InhleiIsInRyYW5zbGF0aW9uIjoid29uIn0seyJ0ZXh0IjoieGUiLCJ0cmFuc2xhdGlvbiI6ImJIdCwgeGVrc2VwdCwgeEhWeSBWeW4ifSx7InRleHQiOiJ4RSIsInRyYW5zbGF0aW9uIjoieHltS3ppTiwgeEhuYmlsSXZ5YnlsLCB4R2JzeWxVdGxpLCBbeGludHlxZWtTeW5dIn0seyJ0ZXh0IjoieEFuIiwidHJhbnNsYXRpb24iOiJ0VSBiaWxvTiB0VSJ9LHsidGV4dCI6InhhbSIsInRyYW5zbGF0aW9uIjoiRmlOLCB4SnR5bSJ9LHsidGV4dCI6InhhIiwidHJhbnNsYXRpb24iOiJ4eXNIbXBTeW4sIGJJIGt5bmRpU3lueiBmTywgeGlmIHhpdCBoR3B5bnogVmVuIn0seyJ0ZXh0IjoidlV4YW4iLCJ0cmFuc2xhdGlvbiI6ImRvZyJ9LHsidGV4dCI6InZ1bEF0IiwidHJhbnNsYXRpb24iOiJmbE8sIHBsS24sIGZsR3QifSx7InRleHQiOiJ2VSIsInRyYW5zbGF0aW9uIjoiW3BBdGlreWwgZk8gblduIGtsT3ogeG92IHhHYnN5bFV0aXYga0tzXSJ9LHsidGV4dCI6InZPeiIsInRyYW5zbGF0aW9uIjoidFUgcHV0LCB0VSBsWGtLdCwgdFUga0lwLCB0VSBwcnl0ZWt0In0seyJ0ZXh0Ijoidk94aXMiLCJ0cmFuc2xhdGlvbiI6InNXbmQsIHNwSWssIHZMcywgdE9rLCBsV2QsIHRVIHNLLCB0VSBzV25kIn0seyJ0ZXh0Ijoidk9zdXQiLCJ0cmFuc2xhdGlvbiI6ImJHZCJ9LHsidGV4dCI6InZPIiwidHJhbnNsYXRpb24iOiJbcEF0aWt5bCBmTyBuV24ga2xPeiB4b3YgeFlneXRpdiBrS3NdIn0seyJ0ZXh0IjoidmlzT3QiLCJ0cmFuc2xhdGlvbiI6ImNKbGQsIGtpZCJ9LHsidGV4dCI6InZpc29tT3oiLCJ0cmFuc2xhdGlvbiI6IndPbSJ9LHsidGV4dCI6InZpa3VzQWwiLCJ0cmFuc2xhdGlvbiI6InhHc2lkLCBzVy95In0seyJ0ZXh0IjoidmlrSW4iLCJ0cmFuc2xhdGlvbiI6InNHbmQifSx7InRleHQiOiJ2aWtha0luIiwidHJhbnNsYXRpb24iOiJnckFzIn0seyJ0ZXh0IjoidmlrIiwidHJhbnNsYXRpb24iOiJzbU9sLCB4eSBiaXQsIHh5IGxpdHlsLCB0VSBTcmlOayJ9LHsidGV4dCI6InZpaFVsIiwidHJhbnNsYXRpb24iOiJkcm9wIn0seyJ0ZXh0IjoidkVrdXQiLCJ0cmFuc2xhdGlvbiI6ImRKcmVrU3luLCB4R05neWwsIHZla3R5In0seyJ0ZXh0IjoidkF0aWsiLCJ0cmFuc2xhdGlvbiI6InBBdGlreWwsIHhlbGltZW50eXJpIHBBdGlreWwsIG1Ka3JYIn0seyJ0ZXh0IjoidmF0QWwiLCJ0cmFuc2xhdGlvbiI6InRVIGdpdiwgdFUgc3ByZWQsIHRVIHBBcywgdFUgZGlza0FyZCwgc0hidHJHa1N5blttR0ZdIn0seyJ0ZXh0IjoidmFrRWwiLCJ0cmFuc2xhdGlvbiI6InRVIGJyS2ssIHRVIGtIdCwgdFUgc3BsaXQifSx7InRleHQiOiJ2QSIsInRyYW5zbGF0aW9uIjoiW3BBdGlreWwgZk8geHl0cmlianl0aXYga2xPel0ifSx7InRleHQiOiJ0T3RldCIsInRyYW5zbGF0aW9uIjoidFUgaGl0In0seyJ0ZXh0IjoidG90IiwidHJhbnNsYXRpb24iOiJmdXQsIGxlZyJ9LHsidGV4dCI6InRvbkFsIiwidHJhbnNsYXRpb24iOiJzSmQsIGJpc0pkLCBuUWJKLCBiSSB3aVYifSx7InRleHQiOiJ0T2tJbiIsInRyYW5zbGF0aW9uIjoibVdudGluIn0seyJ0ZXh0IjoidE9rYWtJbiIsInRyYW5zbGF0aW9uIjoidHJJIn0seyJ0ZXh0IjoidG9rQWciLCJ0cmFuc2xhdGlvbiI6InJlcHRKbHoifSx7InRleHQiOiJ0T2siLCJ0cmFuc2xhdGlvbiI6ImJpZywgdFUgc3dlbCJ9LHsidGV4dCI6InRPaFVsIiwidHJhbnNsYXRpb24iOiJsS2sifSx7InRleHQiOiJ0aWtBbCIsInRyYW5zbGF0aW9uIjoicFcveSwgc3Ryb04sIHBXL3lmeWwifSx7InRleHQiOiJ0aWdBeHVuIiwidHJhbnNsYXRpb24iOiJ4SFZ5LCBkaWZyeW50In0seyJ0ZXh0IjoidGV0ZXpBIiwidHJhbnNsYXRpb24iOiJ0VSBoWGxkIn0seyJ0ZXh0IjoidGV0IiwidHJhbnNsYXRpb24iOiJoR25kLCB0VSB0SGMifSx7InRleHQiOiJ0ZW5JbCIsInRyYW5zbGF0aW9uIjoidFUgZ2V0LCB0VSBnS24sIHRVIHJpc0l2LCB4eWRpU3luIFttR0ZdIn0seyJ0ZXh0IjoidGVnYWtJbiIsInRyYW5zbGF0aW9uIjoiZmlOZ3luS2wifSx7InRleHQiOiJ0ZWciLCJ0cmFuc2xhdGlvbiI6ImZpTmd5LCB0VSBwTG50In0seyJ0ZXh0IjoidGFuT3MiLCJ0cmFuc2xhdGlvbiI6ImhHcGlueXMsIGZIbiwgdFUgcGxLIn0seyJ0ZXh0IjoidCIsInRyYW5zbGF0aW9uIjoidFUgd09rLCB0VSBtVXYsIGJJIGdYL2lOIHRVIGRVIn0seyJ0ZXh0Ijoic1V6IiwidHJhbnNsYXRpb24iOiJuSG1iWSwgeHltV250LCBkaXFpdCwgbWVaeW15bnQsIHRVIGtXbnQsIHRVIG1lWnksIHRVIGt3b250aWZKIn0seyJ0ZXh0Ijoic3V2SXQiLCJ0cmFuc2xhdGlvbiI6InN3SXQsIGtHbmRpIn0seyJ0ZXh0Ijoic3VtRWwiLCJ0cmFuc2xhdGlvbiI6ImhXcywgaFhtLCB0VSBsSnYifSx7InRleHQiOiJzb3phbkFtIiwidHJhbnNsYXRpb24iOiJ3WWQsIG1PZkltIn0seyJ0ZXh0Ijoic094aWsiLCJ0cmFuc2xhdGlvbiI6InNsWCJ9LHsidGV4dCI6InNvdk94aXMiLCJ0cmFuc2xhdGlvbiI6ImZYbkltIn0seyJ0ZXh0Ijoic090IiwidHJhbnNsYXRpb24iOiJoalVteW4sIG1HbiwgcFlzeW4ifSx7InRleHQiOiJzb25JIiwidHJhbnNsYXRpb24iOiJzbWVsIn0seyJ0ZXh0Ijoic29tT3oiLCJ0cmFuc2xhdGlvbiI6ImhvdCwgaEl0In0seyJ0ZXh0Ijoic29tQXoiLCJ0cmFuc2xhdGlvbiI6ImdyR3ZpdGksIHh5dHJHa1N5biJ9LHsidGV4dCI6InNva09tIiwidHJhbnNsYXRpb24iOiJrWGxkIn0seyJ0ZXh0Ijoic29oVWwiLCJ0cmFuc2xhdGlvbiI6IndldCJ9LHsidGV4dCI6InNvYkEiLCJ0cmFuc2xhdGlvbiI6InNvbHQifSx7InRleHQiOiJzSXhhbiIsInRyYW5zbGF0aW9uIjoid0oveSwgbEpuLCBiT2R5LCBoUCwgdFUgbGlOayJ9LHsidGV4dCI6InNpdk94aXMiLCJ0cmFuc2xhdGlvbiI6InNlbnR5bnMsIHN0S3RteW50In0seyJ0ZXh0Ijoic0lzdXQiLCJ0cmFuc2xhdGlvbiI6ImdyVXAsIGtsSHN0eSwgYkhuYywgeHlralVtanVsS1N5biwgdFUgZ0dWeSwgdFUga0FsZWt0In0seyJ0ZXh0Ijoic2lsb2thbSIsInRyYW5zbGF0aW9uIjoic2ltcHlsLCB4SXppIn0seyJ0ZXh0Ijoic2lsQXhpdCIsInRyYW5zbGF0aW9uIjoia0dyaWt0eSwgbGV0eSwgZ2xpZiJ9LHsidGV4dCI6InNpbGFuIiwidHJhbnNsYXRpb24iOiJuZWtzdCJ9LHsidGV4dCI6InNpbCIsInRyYW5zbGF0aW9uIjoiZmpVIn0seyJ0ZXh0Ijoic2lrT21lekEiLCJ0cmFuc2xhdGlvbiI6ImRySW0ifSx7InRleHQiOiJzaWtPbSIsInRyYW5zbGF0aW9uIjoic2xJcCwga2xYcywgc3RvcCJ9LHsidGV4dCI6InNpa0FzIiwidHJhbnNsYXRpb24iOiJ3S2ssIHhYcHluLCBzdEF0In0seyJ0ZXh0Ijoic2F6IiwidHJhbnNsYXRpb24iOiJ4T2wifSx7InRleHQiOiJzQXhpdiIsInRyYW5zbGF0aW9uIjoibUhuaSwgd2VsRiwgYmlsb05pTnosIHByZVN5cyBtZXR5bCJ9LHsidGV4dCI6InNBeGluIiwidHJhbnNsYXRpb24iOiJ3S3YsIGZsSGtjVS9LU3luLCBTS2ssIHZKYnJLU3luLCBwSGxzLCBibGlOaywgc0puIHdLdiJ9LHsidGV4dCI6InNhbEl2dXMiLCJ0cmFuc2xhdGlvbiI6ImJ1ayJ9LHsidGV4dCI6InNha0FuIiwidHJhbnNsYXRpb24iOiJmaVMifSx7InRleHQiOiJzYWdBcyIsInRyYW5zbGF0aW9uIjoidFUgc1ljLCB0VSBmSm5kLCB0VSBoSG50In0seyJ0ZXh0IjoicyIsInRyYW5zbGF0aW9uIjoieHl0ZW1wdCwgdFUgdHJKIn0seyJ0ZXh0Ijoibk9rYW0iLCJ0cmFuc2xhdGlvbiI6InN0aWsifSx7InRleHQiOiJuT2siLCJ0cmFuc2xhdGlvbiI6ImxvTiJ9LHsidGV4dCI6Im5PaFVsIiwidHJhbnNsYXRpb24iOiJyaXZZIn0seyJ0ZXh0Ijoibkl4YW4iLCJ0cmFuc2xhdGlvbiI6ImtHdCJ9LHsidGV4dCI6Im5JIiwidHJhbnNsYXRpb24iOiJuWHosIHRVIHNtZWwifSx7InRleHQiOiJuQXoiLCJ0cmFuc2xhdGlvbiI6ImZBLCBkaXN0eW50In0seyJ0ZXh0IjoibmF6IiwidHJhbnNsYXRpb24iOiJWUCJ9LHsidGV4dCI6Im5hdGVuSWwiLCJ0cmFuc2xhdGlvbiI6InN0SGRpLCB4ZXFVa0tTeW4sIHRVIHN0SGRpLCB0VSBsWW4sIHRVIGdldCBub2xpcSJ9LHsidGV4dCI6Im5BbWFtIiwidHJhbnNsYXRpb24iOiJsS2J5bCJ9LHsidGV4dCI6Im5BbSIsInRyYW5zbGF0aW9uIjoibkttIn0seyJ0ZXh0IjoibkFsIiwidHJhbnNsYXRpb24iOiJqVSBbcGxPcnlsXSJ9LHsidGV4dCI6Im5hbCIsInRyYW5zbGF0aW9uIjoialUgW3NpTmdqdWx5XSJ9LHsidGV4dCI6Im5BIiwidHJhbnNsYXRpb24iOiJWR3QsIFZYeiJ9LHsidGV4dCI6Im4iLCJ0cmFuc2xhdGlvbiI6Im5vbGlxLCB0VSBuWCwgYkkgeEtieWwgdFUifSx7InRleHQiOiJtT3ppbCIsInRyYW5zbGF0aW9uIjoicmVkIn0seyJ0ZXh0IjoibU96ZXoiLCJ0cmFuc2xhdGlvbiI6InJXbmQsIHNZa3lsLCBzZlEifSx7InRleHQiOiJtT3oiLCJ0cmFuc2xhdGlvbiI6ImZKL3ksIGZsS20sIHRVIGJZbiJ9LHsidGV4dCI6Im1veiIsInRyYW5zbGF0aW9uIjoic0htd1AifSx7InRleHQiOiJtb3QiLCJ0cmFuc2xhdGlvbiI6ImJyS24ifSx7InRleHQiOiJtb20iLCJ0cmFuc2xhdGlvbiI6InNIbUZpTiJ9LHsidGV4dCI6Im1vbCIsInRyYW5zbGF0aW9uIjoic0htd29uIn0seyJ0ZXh0IjoibUlsdWsiLCJ0cmFuc2xhdGlvbiI6ImJyZXN0In0seyJ0ZXh0IjoibWlsIiwidHJhbnNsYXRpb24iOiJ4SiwgdFUgc0ksIHRVIHdvYyJ9LHsidGV4dCI6Im1payIsInRyYW5zbGF0aW9uIjoiU090In0seyJ0ZXh0IjoibWV6VWwiLCJ0cmFuc2xhdGlvbiI6InJQLCBub3QgeG9mSG4ifSx7InRleHQiOiJtYXpJdiIsInRyYW5zbGF0aW9uIjoiYlduZHlyaSwgeGVua1dudHksIHhYdnlsR3BpTiwgdFUgbUl0LCB0VSBrQW50R2t0LCB0VSB4aW50eXNla3QifSx7InRleHQiOiJtQXoiLCJ0cmFuc2xhdGlvbiI6Im5RLCB0VSBzdGlrLCB0VSBwS3N0LCB0VSB4eXRyR2t0In0seyJ0ZXh0IjoibWF6IiwidHJhbnNsYXRpb24iOiJoUSJ9LHsidGV4dCI6Im1hdG9sSXhvcyIsInRyYW5zbGF0aW9uIjoicGlySS9BZGlrLCB4aXR5cnl0aXYsIGxVcCwgZnJHa3R5bCwgc2VsZl9yZWZyeW5zIn0seyJ0ZXh0IjoibWFzSW4iLCJ0cmFuc2xhdGlvbiI6Im15U0luIn0seyJ0ZXh0IjoibWFzaWwiLCJ0cmFuc2xhdGlvbiI6Im5qVSJ9LHsidGV4dCI6Im1hbmFsIiwidHJhbnNsYXRpb24iOiJ3SSBbZllzdCwgc2VrSG5kXSJ9LHsidGV4dCI6Im1hbW96IiwidHJhbnNsYXRpb24iOiJ3SWsifSx7InRleHQiOiJtYW1PeiIsInRyYW5zbGF0aW9uIjoiZEsifSx7InRleHQiOiJtYW1BbiIsInRyYW5zbGF0aW9uIjoiZmpVY3kifSx7InRleHQiOiJtQW0iLCJ0cmFuc2xhdGlvbiI6Im1IVlkifSx7InRleHQiOiJtYWxBdiIsInRyYW5zbGF0aW9uIjoibEh2In0seyJ0ZXh0IjoibUFsIiwidHJhbnNsYXRpb24iOiJ3SSBbZllzdF0ifSx7InRleHQiOiJtYWwiLCJ0cmFuc2xhdGlvbiI6InhKIn0seyJ0ZXh0IjoibWFrZW4iLCJ0cmFuc2xhdGlvbiI6InNJenluIn0seyJ0ZXh0IjoibWFrZWhpa0FsIiwidHJhbnNsYXRpb24iOiJuSnQifSx7InRleHQiOiJtYWtBcyIsInRyYW5zbGF0aW9uIjoialEifSx7InRleHQiOiJtYWthayIsInRyYW5zbGF0aW9uIjoid0kgW2ZZc3QsIEZZZF0ifSx7InRleHQiOiJtYWhVbCIsInRyYW5zbGF0aW9uIjoibUhuRiJ9LHsidGV4dCI6Im1hZ0FsYW4iLCJ0cmFuc2xhdGlvbiI6ImxLdHlzdCwgeEd0IGxBc3QifSx7InRleHQiOiJtYWdBbGFtIiwidHJhbnNsYXRpb24iOiJ4WWxpL3lzdCwgeEd0IGZZc3QifSx7InRleHQiOiJtYWdBbCIsInRyYW5zbGF0aW9uIjoieFhsZCJ9LHsidGV4dCI6Im1BIiwidHJhbnNsYXRpb24iOiJWaXMsIFZJeiJ9LHsidGV4dCI6Im0iLCJ0cmFuc2xhdGlvbiI6IkZPdCwgdFUgRmlOaywgdFUgbWVteXJpLCB0VSBtaXMifSx7InRleHQiOiJsVWdBayIsInRyYW5zbGF0aW9uIjoidHdlbHYgdFUgVnkgcFcveSB4b3YgdHdlbHYifSx7InRleHQiOiJsVSIsInRyYW5zbGF0aW9uIjoiW3hpbXBlcnl0aXYgbVVkLCB4aW1wbEpkIHhHYnN5bFV0aXYga0tzIHRVIGJJIFtqVV1dIn0seyJ0ZXh0IjoibE94YWQiLCJ0cmFuc2xhdGlvbiI6InJYZCwgcEdGLCB3SywgcEdzaXEsIHRyR2ssIHhPYml0In0seyJ0ZXh0IjoibG9rYW0iLCJ0cmFuc2xhdGlvbiI6IndZaywgcHJvcWVrdCwgdFUgbUtrLCB0VSBrckkvS3QsIHRVIHhpc3RHYmxpUyJ9LHsidGV4dCI6ImxPZ0FrIiwidHJhbnNsYXRpb24iOiJ0d2VsdiB0VSBWeSBwVy95IHhvdiBzaWtzIn0seyJ0ZXh0IjoibE8iLCJ0cmFuc2xhdGlvbiI6Ilt4aW1wZXJ5dGl2IG1VZCwgeGltcGxKZCB4WWd5dGl2IGtLcyB0VSBiSSBbalVdXSJ9LHsidGV4dCI6ImxJdnVzIiwidHJhbnNsYXRpb24iOiJwS3B5LCBwS3EifSx7InRleHQiOiJsSWdBayIsInRyYW5zbGF0aW9uIjoidHdlbHYgdFUgVnkgcFcveSB4b3YgdHdlbnRpIGZPIn0seyJ0ZXh0IjoibElkYXoiLCJ0cmFuc2xhdGlvbiI6ImtpTiwgbElkeSwgdFUgYkkgeGluIGNBcnEifSx7InRleHQiOiJsRWdBayIsInRyYW5zbGF0aW9uIjoidHdlbHYgdFUgVnkgcFcveSB4b3YgeEt0SW4ifSx7InRleHQiOiJsYXoiLCJ0cmFuc2xhdGlvbiI6ImJvdHltLCBkV24ifSx7InRleHQiOiJsQXhpdCIsInRyYW5zbGF0aW9uIjoickp0aU4sIHhvckZBZ3JIZkksIGtHbGlncnlmaSwgdFUgckp0In0seyJ0ZXh0IjoibEF4ZWsiLCJ0cmFuc2xhdGlvbiI6ImxKaywgeHlwcklTaS9LdCwgeHlkbUoveSwgcHJLeiJ9LHsidGV4dCI6Imxhdk96IiwidHJhbnNsYXRpb24iOiJ0VSBsSiBkV24ifSx7InRleHQiOiJsYXQiLCJ0cmFuc2xhdGlvbiI6InRVIGZPbCJ9LHsidGV4dCI6ImxhbkF6IiwidHJhbnNsYXRpb24iOiJkSXAifSx7InRleHQiOiJsYW1BeiIsInRyYW5zbGF0aW9uIjoiU0dsWCJ9LHsidGV4dCI6Imxha0luIiwidHJhbnNsYXRpb24iOiJ4WUYifSx7InRleHQiOiJsYWh1a1VzIiwidHJhbnNsYXRpb24iOiJib3R5bSBrbFhWeiwgcEFudHMsIHRyV3N5eiJ9LHsidGV4dCI6ImxBZ0FrIiwidHJhbnNsYXRpb24iOiJ0d2VsdiB0VSBWeSBwVy95IHhvdiBGWXRpIn0seyJ0ZXh0IjoibGFiYXoiLCJ0cmFuc2xhdGlvbiI6InNXRiJ9LHsidGV4dCI6ImwiLCJ0cmFuc2xhdGlvbiI6ImxldCwgbUtrIn0seyJ0ZXh0Ijoia3V6VWwiLCJ0cmFuc2xhdGlvbiI6ImJyWGt5biwgeEhuYkdseW5zdCwgW3N3UCB3WWR6XSJ9LHsidGV4dCI6ImtVeGlrIiwidHJhbnNsYXRpb24iOiJmQXN0In0seyJ0ZXh0Ijoia1V4YWdhdCIsInRyYW5zbGF0aW9uIjoiYkhnLCB4aW5zZWt0In0seyJ0ZXh0Ijoia3V0YW0iLCJ0cmFuc2xhdGlvbiI6ImZVZCJ9LHsidGV4dCI6Imt1dGFrSW4iLCJ0cmFuc2xhdGlvbiI6InRVRiwgdFUgYkp0In0seyJ0ZXh0Ijoia3V0IiwidHJhbnNsYXRpb24iOiJtV1YsIHRVIHhJdCwgdFUgZHJpTmsifSx7InRleHQiOiJrdXNBbCIsInRyYW5zbGF0aW9uIjoicm90eW4ifSx7InRleHQiOiJrdWxVbSIsInRyYW5zbGF0aW9uIjoiYlh0LCB2UWt5bCwgeGVsaXZLdHksIGt5bnZLL3kgYmVsdCwgdFUgdHJHbnNwb3J0In0seyJ0ZXh0Ijoia3VsT3MiLCJ0cmFuc2xhdGlvbiI6ImZHYnJpayJ9LHsidGV4dCI6Imt1bEV6IiwidHJhbnNsYXRpb24iOiJrckt6aSwgc3RyS25xLCB3UWQifSx7InRleHQiOiJrb3ZBcyIsInRyYW5zbGF0aW9uIjoiaG9yeSwgdFUgZlEifSx7InRleHQiOiJrb3YiLCJ0cmFuc2xhdGlvbiI6Im5KbiJ9LHsidGV4dCI6ImtPc090IiwidHJhbnNsYXRpb24iOiJzWGwsIGdYc3QifSx7InRleHQiOiJrb3MiLCJ0cmFuc2xhdGlvbiI6InhpbGV2eW4ifSx7InRleHQiOiJrb24iLCJ0cmFuc2xhdGlvbiI6InRlbiJ9LHsidGV4dCI6ImtvbVVnIiwidHJhbnNsYXRpb24iOiJncktuLCBzUXJpL3lseiJ9LHsidGV4dCI6ImtPbWV6IiwidHJhbnNsYXRpb24iOiJoWGwsIGhvbFgsIGtLdiwgcGl0LCBkaXByZVN5biJ9LHsidGV4dCI6ImtvbSIsInRyYW5zbGF0aW9uIjoic2lrcyJ9LHsidGV4dCI6ImtPbSIsInRyYW5zbGF0aW9uIjoidFUgdkduaVMsIHRVIGRpc3lwUSJ9LHsidGV4dCI6ImtPbGFiIiwidHJhbnNsYXRpb24iOiJ0VSBrWC9vcHlyS3QsIHRVIG1HYywgdFUga0FtYkpuLCB0VSBtaWtzIn0seyJ0ZXh0Ijoia09rSW4iLCJ0cmFuc2xhdGlvbiI6InRVIGZySXoifSx7InRleHQiOiJrSXh1dCIsInRyYW5zbGF0aW9uIjoieEF0LCB4SXNGZXRpaywgeEF0aXN0aWssIGRla3J5dGl2LCBialV0aWZ5bCwgcHJpdGksIGtqVXQifSx7InRleHQiOiJraXNPayIsInRyYW5zbGF0aW9uIjoicHJpbnNpcHlsLCByVWwsIHN0ckhrY3ksIHNpc3R5bSwgbE8ifSx7InRleHQiOiJrSXNpbCIsInRyYW5zbGF0aW9uIjoibEp0In0seyJ0ZXh0Ijoia0luaWwiLCJ0cmFuc2xhdGlvbiI6ImplbFgifSx7InRleHQiOiJrSW5leiIsInRyYW5zbGF0aW9uIjoia3dvZHJpbEd0eXJ5bCwgc2t3UCwgcm9tYnlzIn0seyJ0ZXh0Ijoia0luIiwidHJhbnNsYXRpb24iOiJzdFhuLCBzb2xpZCwgdFUgc3lsaWRpZkoifSx7InRleHQiOiJraW1PdCIsInRyYW5zbGF0aW9uIjoiZklsaU4sIHhpbVhTeW4sIHRVIGZJbCJ9LHsidGV4dCI6ImtJa3VsVW0iLCJ0cmFuc2xhdGlvbiI6ImtBLCBiSHMsIHRyS24ifSx7InRleHQiOiJraWsiLCJ0cmFuc2xhdGlvbiI6InhRLCB0VSBsaXN5biJ9LHsidGV4dCI6ImtJaFVsIiwidHJhbnNsYXRpb24iOiJ4SnMifSx7InRleHQiOiJrSWdBbCIsInRyYW5zbGF0aW9uIjoiaGV2aSJ9LHsidGV4dCI6ImtJIiwidHJhbnNsYXRpb24iOiJqZXMsIHhYa0sifSx7InRleHQiOiJrZXoiLCJ0cmFuc2xhdGlvbiI6Im5Yd1AifSx7InRleHQiOiJrZXZPeGlzIiwidHJhbnNsYXRpb24iOiJrd0oveXQsIHNKbHlucyJ9LHsidGV4dCI6ImtFdmlsIiwidHJhbnNsYXRpb24iOiJ0ckduc3BHcnludCJ9LHsidGV4dCI6ImtFdmV6IiwidHJhbnNsYXRpb24iOiJ0ckovR05neWwifSx7InRleHQiOiJrRXZha0VsIiwidHJhbnNsYXRpb24iOiJ0VSBkaXNwWXMifSx7InRleHQiOiJrRXYiLCJ0cmFuc2xhdGlvbiI6IndpbmQsIHhQLCB2R2tqVW0ifSx7InRleHQiOiJrZXYiLCJ0cmFuc2xhdGlvbiI6IkZySSJ9LHsidGV4dCI6Imtlc29oVWwiLCJ0cmFuc2xhdGlvbiI6ImRySiJ9LHsidGV4dCI6ImtlcyIsInRyYW5zbGF0aW9uIjoiZkp2In0seyJ0ZXh0Ijoia2VuZXZpbSIsInRyYW5zbGF0aW9uIjoia3dPdHkifSx7InRleHQiOiJrZW4iLCJ0cmFuc2xhdGlvbiI6ImZPIn0seyJ0ZXh0Ijoia2VtIiwidHJhbnNsYXRpb24iOiJ6UXJYLCBuSEZpTiJ9LHsidGV4dCI6ImtlbGV2aW0iLCJ0cmFuc2xhdGlvbiI6ImhBZiJ9LHsidGV4dCI6ImtFa3V0IiwidHJhbnNsYXRpb24iOiJ0VSBicklWIn0seyJ0ZXh0Ijoia2VrdXQiLCJ0cmFuc2xhdGlvbiI6InRVIHNwaXQifSx7InRleHQiOiJrRWt1bFVtIiwidHJhbnNsYXRpb24iOiJwbEtuIn0seyJ0ZXh0Ijoia2VrT21leiIsInRyYW5zbGF0aW9uIjoiYkhscSwgcHJ5dHJVWnluIn0seyJ0ZXh0Ijoia0VrSW4iLCJ0cmFuc2xhdGlvbiI6InNtWGsifSx7InRleHQiOiJrRWhVbCIsInRyYW5zbGF0aW9uIjoiZm9nIn0seyJ0ZXh0Ijoia2VoaWtBbGlsIiwidHJhbnNsYXRpb24iOiJibEdrIn0seyJ0ZXh0Ijoia2VoaWtBbCIsInRyYW5zbGF0aW9uIjoiZEFrIn0seyJ0ZXh0Ijoia2VoYWJ1ayIsInRyYW5zbGF0aW9uIjoidGlsdGlkIFtub3QgaG9yaXpvbnR5bF0ifSx7InRleHQiOiJrRSIsInRyYW5zbGF0aW9uIjoiblgifSx7InRleHQiOiJrYXpJdCIsInRyYW5zbGF0aW9uIjoiZnJVdCJ9LHsidGV4dCI6ImtBdmlsYWsiLCJ0cmFuc2xhdGlvbiI6Inh5IGdyS1N5cyBqSE4ga2lOIHhvdiBWeSBrSG50cmkgYkdrIHhpbiBWeSBoaXN0eXJpLCB3WVNpcHQgeEd6IHh5IGdvZCBiSiBsS3R5IHFlbnlyS1N5bnoifSx7InRleHQiOiJrYXZBbCIsInRyYW5zbGF0aW9uIjoidFUgY0tucSwgdFUgYmlrSG0sIGJJIHhJa3d5bCB0VSBbbUdGXSJ9LHsidGV4dCI6ImthdEFuIiwidHJhbnNsYXRpb24iOiJuSmYsIHRVIGNvcCwgdFUgc2xHUyJ9LHsidGV4dCI6ImtBc2V6IiwidHJhbnNsYXRpb24iOiJzdEFfU0twdCwgU0FwLCBGT25pLCBwcmlrbGkifSx7InRleHQiOiJrQXMiLCJ0cmFuc2xhdGlvbiI6InhlZ3ppc3R5bnMsIGxKZiwgbGl2aU4sIHRVIHhlZ3ppc3QsIHRVIFNYIHhIcCwgVnkga0hudHJpIHhHbmQgVnkgcGxHbml0IG5LbSBba0FzSF0ifSx7InRleHQiOiJrYWxJdnVzIiwidHJhbnNsYXRpb24iOiJsSWYifSx7InRleHQiOiJrYWxBZCIsInRyYW5zbGF0aW9uIjoiYm9kaSJ9LHsidGV4dCI6Imtha0luaWwiLCJ0cmFuc2xhdGlvbiI6ImdySW4ifSx7InRleHQiOiJrYWtJbiIsInRyYW5zbGF0aW9uIjoicGxHbnQifSx7InRleHQiOiJrQWsiLCJ0cmFuc2xhdGlvbiI6IlZLIn0seyJ0ZXh0Ijoia2FrIiwidHJhbnNsYXRpb24iOiJoSSwgU0ksIHhpdCJ9LHsidGV4dCI6ImthYkFuIiwidHJhbnNsYXRpb24iOiJreW50S255LCBib2tzLCBiR2csIGJIa2l0LCBib3R5bCwgdFUga3ludEtuLCB0VSByR3AifSx7InRleHQiOiJrQSIsInRyYW5zbGF0aW9uIjoiW3BBdGlreWwgZk8gcmlnclVwaU4gbUhsdGlweWwgbW9kaWZKL3l6XSJ9LHsidGV4dCI6ImsiLCJ0cmFuc2xhdGlvbiI6InBvc3liaWxpdGksIHByb2J5YmlsaXRpLCBtS2JJLCBtSywga0duIn0seyJ0ZXh0IjoiaFV2YWtFbCIsInRyYW5zbGF0aW9uIjoidFUgZGlzb2x2In0seyJ0ZXh0IjoiaFVzaWwiLCJ0cmFuc2xhdGlvbiI6ImhBZCJ9LHsidGV4dCI6ImhVbHNleiIsInRyYW5zbGF0aW9uIjoidFUgZGlnIn0seyJ0ZXh0IjoiaFVsZXoiLCJ0cmFuc2xhdGlvbiI6InhBaywga1l2LCBrcmVzeW50In0seyJ0ZXh0IjoiaFVsIiwidHJhbnNsYXRpb24iOiJ3T3R5In0seyJ0ZXh0IjoiaHVrVXMiLCJ0cmFuc2xhdGlvbiI6ImtsWFZ6In0seyJ0ZXh0IjoiaFVrSW4iLCJ0cmFuc2xhdGlvbiI6InNMbCwgZFl0LCBwV2R5LCBwS3N0In0seyJ0ZXh0IjoiaFVnQWwiLCJ0cmFuc2xhdGlvbiI6InNvZnQifSx7InRleHQiOiJoVWJFc3V0IiwidHJhbnNsYXRpb24iOiJ0VSB3b1MifSx7InRleHQiOiJoT3h1aCIsInRyYW5zbGF0aW9uIjoid0ssIG1lRnlkLCBtSW56LCBtSGx0aXBsaWtLU3luIFttR0ZdIn0seyJ0ZXh0IjoiaG9sIiwidHJhbnNsYXRpb24iOiJoQXQifSx7InRleHQiOiJob2dPbGFtIiwidHJhbnNsYXRpb24iOiJ0ckdTIn0seyJ0ZXh0IjoiaG9nT2wiLCJ0cmFuc2xhdGlvbiI6ImRZdGkifSx7InRleHQiOiJoaXZFbnV0IiwidHJhbnNsYXRpb24iOiJ4R2t0aXZpdGksIGZlc3RpdnlsLCBzZXJpbXluaSwgeGl2ZW50LCBwbEduIn0seyJ0ZXh0IjoiaGluQXp1bSIsInRyYW5zbGF0aW9uIjoieGlsZWt0cmlzaXRpLCB4ZWxpa3Ryb25paywgRkhuZHkifSx7InRleHQiOiJoaW1FeiIsInRyYW5zbGF0aW9uIjoieGltaXEsIHBpa2N5LCBmWHRYLCB0VSBwS250In0seyJ0ZXh0IjoiaGlsYWtha0luIiwidHJhbnNsYXRpb24iOiJmbFcvWSJ9LHsidGV4dCI6ImhpbCIsInRyYW5zbGF0aW9uIjoia0hsWSJ9LHsidGV4dCI6Imhpa0FsYW0iLCJ0cmFuc2xhdGlvbiI6ImxHbXAsIGxKdCwgbEFudHluIn0seyJ0ZXh0IjoiaGlrQWwiLCJ0cmFuc2xhdGlvbiI6ImxKdCwgYnJKdCwgdFUgU0puIn0seyJ0ZXh0IjoiaElkZW4iLCJ0cmFuc2xhdGlvbiI6InNJa3JIdCwgdFUgaEpkLCB0VSBrSHZ5IHhIcCJ9LHsidGV4dCI6ImhleiIsInRyYW5zbGF0aW9uIjoiU0twLCBzdEpsLCB4aW1wcmVTeW4sIHBHdHluIn0seyJ0ZXh0IjoiaGVsT3hpbiIsInRyYW5zbGF0aW9uIjoic2VrcyJ9LHsidGV4dCI6ImhlbEFiIiwidHJhbnNsYXRpb24iOiJ0VSBjVXoifSx7InRleHQiOiJoYXpVayIsInRyYW5zbGF0aW9uIjoiU0ttLCBkaXNncktzIn0seyJ0ZXh0IjoiaGF6IiwidHJhbnNsYXRpb24iOiJsZWZ0In0seyJ0ZXh0IjoiaGFrQXMiLCJ0cmFuc2xhdGlvbiI6InhldmlkeW5zLCBzaW1ieWwsIGxYZ1gsIG1Baywgc0puLCBzaW1wdHltIn0seyJ0ZXh0IjoiaGFidWsiLCJ0cmFuc2xhdGlvbiI6Imhvcml6b250eWwifSx7InRleHQiOiJoYWJ1ZyIsInRyYW5zbGF0aW9uIjoiU1hsZHkifSx7InRleHQiOiJoYWJheiIsInRyYW5zbGF0aW9uIjoid2VzdCJ9LHsidGV4dCI6ImgiLCJ0cmFuc2xhdGlvbiI6ImhYcCwgdFUgd29udCwgdFUgd2lTIn0seyJ0ZXh0IjoiZ1VrIiwidHJhbnNsYXRpb24iOiJ0d2VsdiB0VSBWeSBwVy95IHhvdiB0VSJ9LHsidGV4dCI6ImdPayIsInRyYW5zbGF0aW9uIjoidHdlbHYifSx7InRleHQiOiJnSWsiLCJ0cmFuc2xhdGlvbiI6InR3ZWx2IHRVIFZ5IHBXL3kgeG92IGZPIn0seyJ0ZXh0IjoiZ0VrIiwidHJhbnNsYXRpb24iOiJ0d2VsdiB0VSBWeSBwVy95IHhvdiBGckkifSx7InRleHQiOiJnQXZhdEFsIiwidHJhbnNsYXRpb24iOiJick9ka0FzdCwgbEp2c3JJdCJ9LHsidGV4dCI6ImdBbWFtQW5lbSIsInRyYW5zbGF0aW9uIjoiZnlyZXZ5LCB4aXRZbnlsIn0seyJ0ZXh0IjoiZ0Fsb2thbSIsInRyYW5zbGF0aW9uIjoiZGlmaWt5bHQsIGtvbXBsaWtLdGlkIn0seyJ0ZXh0IjoiZ0FsQXhpdCIsInRyYW5zbGF0aW9uIjoieEF0aWt5bCwgdGVrc3QifSx7InRleHQiOiJnQWwiLCJ0cmFuc2xhdGlvbiI6Im1lbmkifSx7InRleHQiOiJnQWtPbSIsInRyYW5zbGF0aW9uIjoiZGVGLCB4eW5KL3lsS1N5biwgdFUgZEosIHRVIGtpbCJ9LHsidGV4dCI6ImdBa0FzIiwidHJhbnNsYXRpb24iOiJ0VSBiSSBiT24ifSx7InRleHQiOiJnQWsiLCJ0cmFuc2xhdGlvbiI6InR3ZWx2IHRVIFZ5IHBXL3kgeG92IGZKdiJ9LHsidGV4dCI6ImdBaFVsIiwidHJhbnNsYXRpb24iOiJzSSwgeFhTeW4ifSx7InRleHQiOiJnIiwidHJhbnNsYXRpb24iOiJkalV0aSwgbnlzZXNpdGksIG1Ic3QsIFN1ZCwgbklkIn0seyJ0ZXh0IjoidnVzVW4iLCJ0cmFuc2xhdGlvbiI6InhvZnluLCBqVVpVL3lsLCBuT215bCJ9LHsidGV4dCI6ImR1eiIsInRyYW5zbGF0aW9uIjoieEhweSwgeEhwIn0seyJ0ZXh0IjoiZHV2T3oiLCJ0cmFuc2xhdGlvbiI6InRVIHN0R25kIn0seyJ0ZXh0IjoiZHV2aWsiLCJ0cmFuc2xhdGlvbiI6IlNPdCBbdll0aWt5bF0ifSx7InRleHQiOiJkdXRPayIsInRyYW5zbGF0aW9uIjoidE9sIn0seyJ0ZXh0IjoiZHV0IiwidHJhbnNsYXRpb24iOiJ0VSBySnoifSx7InRleHQiOiJkdXNPdGFtIiwidHJhbnNsYXRpb24iOiJmUHJpIHRLbCwgbWlGb2x5cWkifSx7InRleHQiOiJkdXNPdCIsInRyYW5zbGF0aW9uIjoiZ29kIn0seyJ0ZXh0IjoiZHVsYWsiLCJ0cmFuc2xhdGlvbiI6InZZdGlreWwifSx7InRleHQiOiJkdWtFdmlsIiwidHJhbnNsYXRpb24iOiJibFUifSx7InRleHQiOiJkdWtFdmFuIiwidHJhbnNsYXRpb24iOiJ0VSBmbEoifSx7InRleHQiOiJkdWtFdiIsInRyYW5zbGF0aW9uIjoic2tKIn0seyJ0ZXh0IjoiZHVrRWhVbCIsInRyYW5zbGF0aW9uIjoia2xXZCJ9LHsidGV4dCI6ImR1aFVsIiwidHJhbnNsYXRpb24iOiJ0VSBmbFh0In0seyJ0ZXh0IjoiZHVodWtVcyIsInRyYW5zbGF0aW9uIjoieEhweSBrbFhWeiwgcUdraXQsIGtYdCJ9LHsidGV4dCI6ImR1Z2FsYW0iLCJ0cmFuc2xhdGlvbiI6Im5layJ9LHsidGV4dCI6ImR1ZyIsInRyYW5zbGF0aW9uIjoiaGVkIn0seyJ0ZXh0IjoiZHViYXoiLCJ0cmFuc2xhdGlvbiI6Im5PRiJ9LHsidGV4dCI6ImRPeiIsInRyYW5zbGF0aW9uIjoid1AifSx7InRleHQiOiJkT3h1ZyIsInRyYW5zbGF0aW9uIjoidFVsLCBqVXRlbnN5bCJ9LHsidGV4dCI6ImRPbVVuIiwidHJhbnNsYXRpb24iOiJ3SiJ9LHsidGV4dCI6ImRPbWFtIiwidHJhbnNsYXRpb24iOiJ3ZW4ifSx7InRleHQiOiJkT20iLCJ0cmFuc2xhdGlvbiI6IndvdCJ9LHsidGV4dCI6ImRPbCIsInRyYW5zbGF0aW9uIjoiaFUifSx7InRleHQiOiJkT2ciLCJ0cmFuc2xhdGlvbiI6ImhXIn0seyJ0ZXh0IjoiZE9idXMiLCJ0cmFuc2xhdGlvbiI6InhHbmlteWwifSx7InRleHQiOiJkYW1hbSIsInRyYW5zbGF0aW9uIjoiblcifSx7InRleHQiOiJkYWJheiIsInRyYW5zbGF0aW9uIjoiZmVsWCwgYnJIVnksIGZyZW5kIn0seyJ0ZXh0IjoiZCIsInRyYW5zbGF0aW9uIjoidFUgd0t0In0seyJ0ZXh0IjoiYnV6IiwidHJhbnNsYXRpb24iOiJySnQifSx7InRleHQiOiJidWJheiIsInRyYW5zbGF0aW9uIjoieElzdCJ9LHsidGV4dCI6ImJFc3V0IiwidHJhbnNsYXRpb24iOiJndWQsIHdlbCwgcHJvcHksIGt5cmVrdCwgbEhrLCB0VSB4SHBncktkIn0seyJ0ZXh0IjoiYkVsdWQiLCJ0cmFuc2xhdGlvbiI6ImJZZCJ9LHsidGV4dCI6ImJFIiwidHJhbnNsYXRpb24iOiJzeXBySnppTmxpLCB4R2tzaWRlbnR5bGksIHhJdnluLCB4WG5saSwgc3RpbCwgW3hpbnR5cWVrU3luXSJ9LHsidGV4dCI6ImJheiIsInRyYW5zbGF0aW9uIjoicGxLcywgbFhrS1N5biwgcHl6aVN5biwgdGVyaXR5cmkifSx7InRleHQiOiJiQXhpdCIsInRyYW5zbGF0aW9uIjoidFUgZkp0In0seyJ0ZXh0IjoiYkF4aWJhbSIsInRyYW5zbGF0aW9uIjoia3ltb2RpdGksIHByb2RIa3QifSx7InRleHQiOiJiQXhpYiIsInRyYW5zbGF0aW9uIjoiYml6bnlzLCBtWWN5bnQsIGt5bVlTeWwsIHRVIHRyS2QifSx7InRleHQiOiJiQWIiLCJ0cmFuc2xhdGlvbiI6ImZBVnkifV0="
    const wordList = JSON.parse(atob(encodedData));
    const keyMap   = { 
        o: { kaasa: 'o', code: 'KeyO' },
        u: { kaasa: 'u', code: 'KeyU' },
        e: { kaasa: 'e', code: 'KeyE' },
        i: { kaasa: 'i', code: 'KeyI' },
        a: { kaasa: 'a', code: 'KeyA' },
        
        p: { kaasa: 'O', code: 'KeyP' },
        y: { kaasa: 'U', code: 'KeyY' },
        w: { kaasa: 'E', code: 'KeyW' },
        j: { kaasa: 'I', code: 'KeyJ' },
        q: { kaasa: 'A', code: 'KeyQ' },
        // 辅音
        b: { kaasa: 'b', code: 'KeyB' },
        v: { kaasa: 'v', code: 'KeyV' },
        m: { kaasa: 'm', code: 'KeyM' },

        t: { kaasa: 't', code: 'KeyT' },
        d: { kaasa: 'd', code: 'KeyD' },
        n: { kaasa: 'n', code: 'KeyN' },

        s: { kaasa: 's', code: 'KeyS' },
        z: { kaasa: 'z', code: 'KeyZ' },
        l: { kaasa: 'l', code: 'KeyL' },

        k: { kaasa: 'k', code: 'KeyK' },
        g: { kaasa: 'g', code: 'KeyG' },
        h: { kaasa: 'h', code: 'KeyH' }
    };

    // --------- Base12 转换 ---------
    const base12Digits = ['0','1','2','3','4','5','6','7','8','9','-','='];
    function toBase12(num) {
      let n = Math.floor(num);
      if (n === 0) return '0';
      let result = '';
      const negative = n < 0;
      if (negative) n = -n;
      while (n > 0) {
        result = base12Digits[n % 12] + result;
        n = Math.floor(n / 12);
      }
      return negative ? '_' + result : result;
    }

    // --------- 全局状态 ---------
    let selectedLayout = '';
    let timer           = ROUND_TIME;
    let totalKeystrokes = 0;
    let correctKeystrokes = 0;
    let errorCount      = 0;
    let score           = 0;
    let usedIndices     = new Set();
    let currentIndex    = -1;
    let currentPos      = 0;
    let segments = [];
    let uppercasePending = false;
    let pendingVowelKey = '';
    let resetImgTimeoutId = null;

    // --------- DOM 引用 ---------
    const selectLayout = document.getElementById('select-layout');
    const gameScreen   = document.getElementById('game-screen');
    const keyboardEl   = document.getElementById('keyboard');
    const currentWordEl= document.getElementById('current-word');
    const translationEl= document.getElementById('translation');
    const timerEl      = document.getElementById('timer-small');
    const characterImg = document.getElementById('character');
    const resultScreen = document.getElementById('result-screen');
    const finalScoreEl = document.getElementById('final-score');
    const accuracyEl   = document.getElementById('accuracy');
    const wpmEl        = document.getElementById('wpm');
    const rankEl   = document.getElementById('rank');
    const restartBtn   = document.getElementById('restart');
    const bgMusic    = document.getElementById('bg-music');
    const sfxCorrect = document.getElementById('sfx-correct');
    const sfxWrong   = document.getElementById('sfx-wrong');
    const sfxDone    = document.getElementById('sfx-done');
    const allSfx = [sfxCorrect, sfxWrong, sfxDone];
    const countdownSound   = document.getElementById('countdown-sound');
    const endPositiveSound = document.getElementById('end-positive-sound');
    const resultCharacterEl = document.getElementById('result-character');

    function setCharacterState(state) {
      // 先清掉上一次没执行完的重置
      if (resetImgTimeoutId !== null) {
        clearTimeout(resetImgTimeoutId);
        resetImgTimeoutId = null;
      }

      // 切 src
      switch(state) {
        case 'success':
          characterImg.src = 'images/character_success.png';
          break;
        case 'fail':
          characterImg.src = 'images/character_fail.png';
          break;
        case 'finish':
          characterImg.src = 'images/character_finish.png';
          break;
        default:
          characterImg.src = 'images/character_idle.png';
      }

      // 然后排个新任务：500ms 后还原 idle
      resetImgTimeoutId = setTimeout(() => {
        characterImg.src = 'images/character_idle.png';
        resetImgTimeoutId = null;
      }, 500);
    }

    function playSfxEffect(audioEl) {
      // 先停掉并重置三种音效
      allSfx.forEach(a => {
        a.pause();
        a.currentTime = 0;
      });
      // 再播放目标音效
      audioEl.play().catch(()=>{ /* 忽略 play() Promise 拒绝 */ });
    }

    // 构建键盘
    function buildKeyboard(layout) {
      selectedLayout=layout;
      keyboardEl.innerHTML = '';
      const rows = {
        'alternate': [
          ['q','w','e','r','t','y','u','i','o','p'],
          ['a','s','d','f','g','h','j','k','l',';'],
          ['z','x','c','v','b','n','m',',','.','/']
        ],
        'double': [ 
          ['q','w','e','r','t','y','u','i','o','p'],
          ['a','s','d','f','g','h','j','k','l',';'],
          ['z','x','c','v','b','n','m',',','.','/']
        ]
      };
      rows[layout].forEach(row=>row.forEach(key=>{
        let div=document.createElement('div');div.className='key';div.dataset.key=key;div.dataset.kaasa=keyMap[key]?.kaasa||'';
        keyboardEl.appendChild(div);
      }));
      if(layout==='double'){
        ['p','y','w','j','q'].forEach(k=>{
          let el=keyboardEl.querySelector(`.key[data-key="${k}"]`);
          if(el){el.dataset.kaasa='';el.classList.add('disabled');}
        });
      }
    }

    // 工具函数：判断元音
    function isVowel(c) {
      return /[aeiouAEIOU]/.test(c);
    }
    // 分割为段（处理 x+元音）
    function getSegments(text) {
      const chars = Array.from(text.normalize('NFC'));
      const segs = [];
      for (let i = 0; i < chars.length; i++) {
        const c = chars[i];
        if ((c === 'x' || c === 'X') && i + 1 < chars.length && isVowel(chars[i+1])) {
          segs.push(c + chars[i+1]);
          i++;
        } else {
          segs.push(c);
        }
      }
      return segs;
    }

    // 渲染段
    function renderWord(text) {
      currentWordEl.innerHTML = '';
      segments = getSegments(text);
      segments.forEach(seg => {
        const span = document.createElement('span');
        span.textContent = seg;
        currentWordEl.appendChild(span);
      });
    }

    // 布局选择
    selectLayout.querySelectorAll('.layout-option').forEach(opt => {
      opt.addEventListener('click', () => {
        buildKeyboard(opt.dataset.layout);
        selectLayout.style.display = 'none';
        startCountdown();
      });
    });

    // 倒计时阶段显示游戏界面并渲染计时
    function startCountdown() {
      countdownSound.currentTime = 0;
      countdownSound.play().catch(() => { /* 忽略自动播放限制 */ });

      gameScreen.style.visibility = 'visible';
      // 隐藏翻译，放大倒计时
      translationEl.style.visibility = 'hidden';
      timerEl.style.visibility = 'hidden';
      currentWordEl.classList.add('countdown');
      let cd = COUNTDOWN_TIME;
      currentWordEl.textContent = toBase12(cd);
      const interval = setInterval(() => {
        cd--;
        currentWordEl.textContent = cd > 0 ? toBase12(cd) : 'sikAs!';
        if (cd <= 0) {
          clearInterval(interval);
          // 恢复样式
          currentWordEl.classList.remove('countdown');
          translationEl.style.visibility = '';
          timerEl.style.visibility = '';
          timerEl.style.display = '';
          beginGame();
        }
      }, 1000);
    }

    // 游戏开始
    let gameInterval = null;
    function beginGame() {
      bgMusic.currentTime = 0;
      bgMusic.play().catch(()=>{/* 某些浏览器需要用户交互，忽略异常 */});
      setNextWord();
      timerEl.innerHTML = `<span class=\"timer-icon\">⏳</span><span class=\"timer-num\">${toBase12(timer)}</span>`;
      gameInterval = setInterval(() => {
        timer--;
        timerEl.innerHTML = `<span class="timer-icon">⏳</span><span class="timer-num">${toBase12(timer)}</span>`;

        if (timer <= 0) {
          clearInterval(gameInterval); 
          endGame();
        }
      }, 1000);
      document.addEventListener('keydown', onKeyPress);
    }

    // 抽词
    function setNextWord() {
      if (usedIndices.size === wordList.length) usedIndices.clear();
      do { currentIndex = Math.floor(Math.random() * wordList.length); }
      while (usedIndices.has(currentIndex));
      usedIndices.add(currentIndex);
      currentPos = 0;
      const { text, translation } = wordList[currentIndex];
      renderWord(text);
      translationEl.textContent   = translation;
    }

    // 按键处理
    function onKeyPress(e) {
      const key = e.key.toLowerCase();
      totalKeystrokes++;
      const keyEls = document.querySelectorAll(`.key[data-key='${key}']`);

      // —— 如果正在等待第二次按同一个元音 —— 
      if (uppercasePending) {
        // 再次高亮同一个元音键
        keyEls.forEach(el => el.classList.add('active'));

        // 按对了：完成大写元音
        if (key === pendingVowelKey) {
          setCharacterState('success');
          playSfxEffect(sfxCorrect);
          correctKeystrokes++;
          currentWordEl.children[currentPos].classList.add('correct');
          currentPos++;
          // 重置状态
          uppercasePending = false;
          // 如果单词输完换下一个
          if (currentPos === segments.length) {
            setCharacterState('finish');
            playSfxEffect(sfxDone);
            score += segments.length * BONUS_SCORE;
            setNextWord();
          }
        } else {
          // 按错了
          setCharacterState('fail');
          playSfxEffect(sfxWrong);
          errorCount++; score -= PUNISH_SCORE;
          keyEls.forEach(el => el.classList.add('wrong'));
          // 重置标志
          uppercasePending = false;
        }

        // 清除反馈
        setTimeout(() => {
          keyEls.forEach(el => el.classList.remove('active','wrong'));
        }, 150);
        return;
      }

      // —— AZERTY 下需要双按的“第一步”：检测到大写元音 —— 
      const expectedSeg  = segments[currentPos];
      const expectedChar = expectedSeg[expectedSeg.length - 1];
      if (
        selectedLayout === 'double' &&
        expectedChar === expectedChar.toUpperCase() &&
        isVowel(expectedChar)
      ) {
        // 如果第一次按对了小写元音键，就进入“等待第二次确认”状态
        if (keyMap[key]?.kaasa === expectedChar.toLowerCase()) {
          setCharacterState('success');
          playSfxEffect(sfxCorrect);
          correctKeystrokes++;
          pendingVowelKey = key;            // 记录是哪一个元音键
          uppercasePending = true;          // 切换到等待状态
          keyEls.forEach(el => el.classList.add('active'));
        } else {
          // 第一步就按错
          setCharacterState('fail');
          playSfxEffect(sfxWrong);
          errorCount++; score -= PUNISH_SCORE;
          keyEls.forEach(el => el.classList.add('wrong'));
        }
        setTimeout(() => {
          keyEls.forEach(el => el.classList.remove('active','wrong'));
        }, 150);
        return;
      }

      // —— 普通单键输入流程 —— 
      keyEls.forEach(el => el.classList.add('active'));
      if (keyMap[key]?.kaasa === expectedChar) {
        setCharacterState('success');
        playSfxEffect(sfxCorrect);
        correctKeystrokes++;
        currentWordEl.children[currentPos].classList.add('correct');
        currentPos++;
        if (currentPos === segments.length) {
          setCharacterState('finish');
          playSfxEffect(sfxDone);
          score += segments.length * BONUS_SCORE;
          setNextWord();
        }
      } else {
        setCharacterState('fail');
        playSfxEffect(sfxWrong);
        errorCount++; score -= PUNISH_SCORE;
        keyEls.forEach(el => el.classList.add('wrong'));
      }
      setTimeout(() => {
        keyEls.forEach(el => el.classList.remove('active','wrong'));
      }, 150);
    }



    // 游戏结束

    function endGame() {
      let charSrc;
      if (score <= 0) {
        charSrc = 'images/character_fail.png';
        rankEl.textContent   = 'vOsut';
      } else if (score < 103680) {
        charSrc = 'images/character_idle.png';
        rankEl.textContent   = 'vusUn';
      } else if (score < 165888) {
        charSrc = 'images/character_success.png';
        rankEl.textContent   = 'bEsut';
      } else {
        charSrc = 'images/character_finish.png';
        rankEl.textContent   = 'mezUl';
      }
      resultCharacterEl.src = charSrc;

      bgMusic.pause();
      document.removeEventListener('keydown', onKeyPress);

      if (score > 0) {
        endPositiveSound.loop = false;
        endPositiveSound.currentTime = 0;
        endPositiveSound.play().catch(() => {});
      }

      resultScreen.style.display = 'flex';
      finalScoreEl.innerHTML   = `tenIl/a sUz ' <span class=\"value\">${toBase12(score)}</span>`;

      const accuracy = totalKeystrokes ? (correctKeystrokes/totalKeystrokes*144).toFixed(1) : 0;
      accuracyEl.innerHTML     = `bEsut/a sUz ' <span class=\"value\">${toBase12(accuracy)}</span>`;
      // 速度（WPM）
      const minutes = ROUND_TIME / 60;
      const wpm = totalKeystrokes ? Math.round(correctKeystrokes / minutes) : 0;
      wpmEl.innerHTML = `kUxik/a sUz ' <span class=\"value\">${toBase12(wpm)}</span>`;

      const stats = [rankEl,finalScoreEl, accuracyEl, wpmEl];
      stats.forEach(el => {
        if (score <= 0) {
          // setProperty 的第三个参数可以加上 'important'
          el.style.setProperty('color', 'var(--warning)', 'important');
        } else if (score < 103680) {
          el.style.setProperty('color', 'white', 'important');
        } else if (score < 165888) {
          el.style.setProperty('color', 'var(--primary)', 'important');
        } else {
          el.style.setProperty('color', 'var(--secondary)', 'important');
        }
      });      
    }

    restartBtn.addEventListener('click', () => location.reload());
  </script>
</body>
</html>
